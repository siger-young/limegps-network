(function(e){function t(t){for(var r,o,u=t[0],c=t[1],l=t[2],d=0,p=[];d<u.length;d++)o=u[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);s&&s(t);while(p.length)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,u=1;u<n.length;u++){var c=n[u];0!==i[c]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={index:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var u=window["webpackJsonp"]=window["webpackJsonp"]||[],c=u.push.bind(u);u.push=t,u=u.slice();for(var l=0;l<u.length;l++)t(u[l]);var s=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("dffc")},"0aa1":function(e,t,n){},"248e":function(e,t,n){"use strict";n("0aa1")},dffc:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("page-map")},a=[],o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticStyle:{height:"500px",width:"100%"}},[n("p",[e._v(e._s(e.currentCenter))]),e.showMap?n("l-map",{staticStyle:{height:"80%"},attrs:{zoom:e.zoom,center:e.center,options:e.mapOptions},on:{"update:center":e.centerUpdate,"update:zoom":e.zoomUpdate}},[n("l-tile-layer",{attrs:{url:e.url,attribution:e.attribution}}),e._l(e.markers,(function(t){return n("l-circle-marker",{key:t.id,attrs:{"lat-lng":t.latLng,radius:t.radius,color:t.id==e.activeMarkerId?"#00FF00":"#0000FF"}})})),n("l-polyline",{attrs:{"lat-lngs":e.route,color:"#FF0000"}}),n("l-control",{attrs:{position:"bottomleft"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.cyclic,expression:"cyclic"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.cyclic)?e._i(e.cyclic,null)>-1:e.cyclic},on:{change:function(t){var n=e.cyclic,r=t.target,i=!!r.checked;if(Array.isArray(n)){var a=null,o=e._i(n,a);r.checked?o<0&&(e.cyclic=n.concat([a])):o>-1&&(e.cyclic=n.slice(0,o).concat(n.slice(o+1)))}else e.cyclic=i}}}),e._v("Cyclic Route"),n("br"),n("label",{attrs:{for:"inputSpeed"}},[e._v("Speed (min/km)")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.speed,expression:"speed",modifiers:{number:!0}}],attrs:{id:"inputSpeed",type:"text",placeholder:"min/km"},domProps:{value:e.speed},on:{input:function(t){t.target.composing||(e.speed=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),n("br"),n("label",{attrs:{for:"inputMinimalTick"}},[e._v("Minimal Tick (s)")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.minimalTick,expression:"minimalTick",modifiers:{number:!0}}],attrs:{id:"inputMinimalTick",type:"text",placeholder:"s"},domProps:{value:e.minimalTick},on:{input:function(t){t.target.composing||(e.minimalTick=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),n("br"),n("label",{attrs:{for:"inputShuffleAccuracy"}},[e._v("Shuffle Accuracy (deg)")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.shuffleAccuracy,expression:"shuffleAccuracy",modifiers:{number:!0}}],attrs:{id:"inputShuffleAccuracy",type:"text",placeholder:"deg"},domProps:{value:e.shuffleAccuracy},on:{input:function(t){t.target.composing||(e.shuffleAccuracy=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),n("br"),n("label",{attrs:{for:"inputRounds"}},[e._v("Rounds")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.rounds,expression:"rounds",modifiers:{number:!0}}],attrs:{id:"inputRounds",type:"text",placeholder:"rounds"},domProps:{value:e.rounds},on:{input:function(t){t.target.composing||(e.rounds=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),n("br"),n("button",{on:{click:e.sample}},[e._v("Sample")]),n("button",{on:{click:e.shuffuleRoute}},[e._v("Shuffle")]),n("button",{on:{click:e.resetRoute}},[e._v("No Shuffle")]),n("button",{on:{click:e.exportRoute}},[e._v("Export")]),n("button",{on:{click:e.calibrate}},[e._v("Calibrate")]),n("button",{on:{click:e.startSdr}},[e._v("Start")])])],2):e._e(),n("vue-dropzone",{ref:"dropzone",attrs:{id:"drop",options:e.dropOptions},on:{"vdropzone-file-added":e.fileAdded}})],1)])},u=[],c=(n("99af"),n("a15b"),n("d81d"),n("d3b7"),n("5530")),l=(n("96cf"),n("1da1")),s=n("e11e"),d=n.n(s),p=n("4e2b"),f=n("f60f"),m=n("635f"),h=n("2699"),v=n("a40a"),g=n("ea97"),b=n("2253"),y=n("92c3"),x=n.n(y);n("ac1f"),n("466d"),n("1276"),n("498a");function k(e){return new Promise((function(t,n){var r=new FileReader;r.onloadend=function(e){var n=e.target.result;t(n)},r.onerror=function(e){n(e)},r.readAsText(e)}))}function O(e){return e.split("\n").map((function(e){var t=e.split(",").map((function(e){return e.trim()}));return{latitude:t[0],longitude:t[1]}}))}function w(e){var t=e.match(/<coordinates>([\S\s]*?)<\/coordinates>/)[1].trim().split(" ");return t.map((function(e){var t=e.split(",").map((function(e){return e.trim()}));return{latitude:t[1],longitude:t[0]}}))}function j(e){}function _(e){return S.apply(this,arguments)}function S(){return S=Object(l["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k(t);case 3:n=e.sent,e.t0=t.type,e.next="text/csv"===e.t0?7:"application/json"===e.t0?8:"application/vnd.google-earth.kml+xml"===e.t0?9:"application/gpx+xml"===e.t0?10:11;break;case 7:return e.abrupt("return",O(n));case 8:return e.abrupt("return",JSON.parse(n));case 9:return e.abrupt("return",w(n));case 10:return e.abrupt("return",j(n));case 11:throw new Error("Unsupported navigation file.");case 12:e.next=17;break;case 14:throw e.prev=14,e.t1=e["catch"](0),new Error("Error when parsing navigation file: ".concat(e.t1.message));case 17:case"end":return e.stop()}}),e,null,[[0,14]])}))),S.apply(this,arguments)}var I={longitude:114.393833,latitude:30.508959},M=(n("b680"),n("8c84"));function T(e,t,n){return{longitude:(1-n)*e.longitude+n*t.longitude,latitude:(1-n)*e.latitude+n*t.latitude}}function P(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=[],i=0,a=t*n,o=1;o<e.length;o++){var u=Object(M["getDistance"])(e[o-1],e[o]);if(u<a)r.push(Object(c["a"])(Object(c["a"])({},e[o]),{},{tick:i.toFixed(1)})),i+=n;else for(var l=Math.round(u/a),s=1;s<=l;s++)r.push(Object(c["a"])(Object(c["a"])({},T(e[o-1],e[o],s/l)),{},{tick:i.toFixed(1)})),i+=n}return r}var A=n("ec26"),R=n("9db1"),L=n.n(R);d.a,p["a"],f["a"],m["a"];var z={name:"PageMap",components:{LMap:h["a"],LTileLayer:v["a"],LPolyline:m["a"],LCircleMarker:g["a"],LControl:b["a"],VueDropzone:x.a},data:function(){return{dropOptions:{url:"/",thumbnailWidth:150,maxFilesize:1},mapOptions:{zoomSnap:.5},url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',zoom:17,center:Object(s["latLng"])(I.latitude,I.longitude),currentCenter:null,showMap:!0,nav:[],route:[],samples:[],finals:[],markers:[],cyclic:!0,speed:7,shuffleAccuracy:1e-5,minimalTick:3,timer:null,rounds:1,roundIndex:0,timerIndex:0,activeMarkerId:null}},computed:{realSpeed:function(){return 1e3/(60*this.speed)}},methods:{zoomUpdate:function(e){this.currentZoom=e},centerUpdate:function(e){this.currentCenter=e},showLongText:function(){this.showParagraph=!this.showParagraph},fileAdded:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,_(e);case 2:r=n.sent,t.nav=r,t.sample(),t.$refs.dropzone.removeAllFiles();case 6:case"end":return n.stop()}}),n)})))()},sample:function(){console.log(this.minimalTick),this.cyclic&&this.nav[this.nav.length-1]!=this.nav[0]&&this.nav.push(this.nav[0]),this.route=this.nav.map((function(e){return Object(s["latLng"])(e.latitude,e.longitude)})),console.log(this.route),this.samples=P(this.nav,this.realSpeed,this.minimalTick),this.center=Object(s["latLng"])(this.nav[0].latitude,this.nav[0].longitude),this.resetRoute()},resetRoute:function(){this.finals=this.samples.map((function(e){return e})),this.markers=this.finals.map((function(e){return{id:Object(A["a"])(),radius:1,latLng:Object(s["latLng"])(e.latitude,e.longitude)}}))},shuffuleRoute:function(){var e=this;console.log(this.samples),this.finals=this.samples.map((function(t){return Object(c["a"])(Object(c["a"])({},t),{},{latitude:1*t.latitude+(.5-Math.random())*e.shuffleAccuracy,longitude:1*t.longitude+(.5-Math.random())*e.shuffleAccuracy})})),this.markers=this.finals.map((function(e){return{id:Object(A["a"])(),radius:1,latLng:Object(s["latLng"])(e.latitude,e.longitude)}}))},exportRoute:function(){var e=this.finals.map((function(e){return"".concat(e.tick,",").concat(L.a.project(e.latitude,e.longitude,0).join(","))})).join("\n"),t=document.createElement("a");t.href="data:text/csv;charset=utf-8,"+encodeURIComponent(e),t.target="_blank",t.download="data.csv",t.click()},calibrate:function(){this.activeMarkerId=this.markers[0].id,fetch("/api/sdr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latitude:this.finals[0].latitude,longitude:this.finals[0].longitude})})},startSdr:function(){var e=this;null!=this.timer?(clearInterval(this.timer),this.timer=null):(this.activeMarkerId=null,this.timerIndex=0,this.roundIndex=0,this.timer=setInterval((function(){fetch("/api/sdr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latitude:e.finals[e.timerIndex].latitude,longitude:e.finals[e.timerIndex].longitude})}),e.activeMarkerId=e.markers[e.timerIndex].id,e.timerIndex++,e.timerIndex>=e.finals.length&&(e.timerIndex=0,e.roundIndex++,e.roundIndex>=e.rounds&&(clearInterval(e.timer),e.timer=null))}),1e3*this.minimalTick))}}},U=z,F=n("2877"),C=Object(F["a"])(U,o,u,!1,null,null,null),N=C.exports,$={name:"App1",components:{PageMap:N}},E=$,J=(n("248e"),Object(F["a"])(E,i,a,!1,null,null,null)),D=J.exports;n("6cc5"),n("1e3f");delete s["Icon"].Default.prototype._getIconUrl,s["Icon"].Default.mergeOptions({iconRetinaUrl:n("584d"),iconUrl:n("6397"),shadowUrl:n("e2b9")}),r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(D)}}).$mount("#app")}});
//# sourceMappingURL=index.2d0236b9.js.map